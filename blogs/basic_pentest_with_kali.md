# Post-install tasks

## Updating Linux

* `Apt-get update`
* `Apt-get upgrade -y`
* `Apt-get dist-upgrade -y`
* reboot

* Create shell script e.g. **upgrade.sh**
  * Leafpad kali_upgrade.sh (create and edit a shell script)
  * One line in this script:
    `apt-get update && apt-get upgrade -y && apt-get dist-upgrade -y`
* Add execute right to this sh script
  * `Chmod +x kali_update.sh`

* Show the list of packages: `dpkg -l`
* Show the list of specific packages: `dpkg -l | grep zip`

## Install tools

* Apt-get install preload
* Apt-get install bleachbit
* Apt-get install bum (boot up manager)
* Apt-get install gnome-do
* Apt-get install apt-file
* Apt-get install scrub (secure delete)
* Apt-get install shutter (screenshot maker)
* Apt-get install figlet (custom headline into command console)
  * Edit headline
		`leafpad /root/.bashrc`
		scroll down to the end of the file and insert: `figlet iloilo`

## Config ssh (replace original SSL key):

- Cd /etc/ssh (navigate to SSH folder)
- Mkdir keys_backup_ssh (create folder for original key backup)
- Mv ssh_host_* keys_backup_ssh (move original key to backup folder)
- Dpkg-reconfigure openssh-server (generate new keys)
- Service ssh start (start SSH service)
- Netstat -antp (check if SSH is listening)
- Service ssh stop (stop the ssh service)

## Install tor

- Apt-get install tor
- Leafpad /etc/proxychains.conf
		○ Comment "strict chain" (put # in front of)
		○ Enable "dynamic chain" (delete the "#")
		○ At the end of the file type: "socks5 127.0.0.1 9050"
- Service tor start
- Service tor status (check it is running)
- Browse the net through tor: "proxychains iceweasel www.whatsmyip.com"

## Check Kali system against rootkits

- chkrootkit

## Make notes

- "Keepnote" under programs/kali/reporting/documents

## Preconfigured Test-Servers

- Metasploitable OS (downloadable by design vulnerable Linux VM)
- Turnkeylinux.org: preconfigured VMs (Wordpress, Joomla, …)

---
# Gathering Information

## Google dorks

- Cache: URL [string]
- Filetype: [type]
- Info: [string]
- Intitle: [string]
- Inurl: [string]
- Site: [domain/website][string]
	
- Examples:
  - Filetype:pdf site:www.valami.com (pdf file-t keres a site-on)
  - Site:www.valami.com intitle:login (a login keyword-öt keresi a site-on)
  - Site:pastebin.com www.valami.com (a pastebin-en keres a valami.com-al kapcsolatos infókat)
- A pastebin-re szokták közzétenni a lopott jelszavakat és egyéb sötét dolgokat

	- Expoite-DB (iceweasel böngésző kedvencei között) a legújabb sebezhetőségek webes adatbázisa
		○ ebben van egy link: Google Hacking Database
ez a Google Dorks infók legjobb forrása, rengeteg példával
		
Dnssuff.com
	- Dns, whois, IP
	- Go to tools (bottom of the page)

Metagoofil
	- From a command console: metagoogfil
(collects and organizes data from a site)

TheHarvester
	- Command console: theharvester
	(collects email addresses and other information about a site from google, linkedin, …)

Whois
	- Command console: whois valami.com

DNS reconnaissance
	- Command console: fierce -dns valami.com
(Brute force domain names and find e.g. ftp.valami.com, admin.valami.com, …)

DeepMagic Info Gathering (dmitry)
	- Command console: dmitry -winsepfbo valami.com
(query a lot of stuff: whois, domain names, email addresses, port scan, …)

Discover with scripts (leebaird's discover)
	- Console: git clone https://github.com/leebaird/discover.git
	- Cd discover
	- Discover.sh (run almost all the above info gathering tools)
	- Open the report in a browser and see the results in a well organized html page

Info gathering with recon-ng
	- (Written in python)
	- Install: apt-get install recon-ng
	- Start: recon-ng
		○ Show modules
		○ Load ipinfodb (free registration and api key needed)
		○ Show info
	- Check the results in a well organized html page

![image](https://user-images.githubusercontent.com/57397545/159085466-2ec98ff3-4e9e-4d24-89ad-0733fb975f96.png)

---
# External PenTesting

Traceroute tools
	- Traceroute [target host]
	- Nmap -v --traceroute [target host]
Ping tools
	- Nmap
	- Hping3
		○ Hping3 -S www.valami.com -p 80 -c 3 (tcp 80, 3 packets)
	- Ping
		○ Ping www.valami.com -c 3 (3 packet sent)
Portscan tools
	- Nmap
		○ Synscan (a port is listening or open)
nmap -T4 -v -PN -n -sS --top-ports 100 --max-parallelism 10 -oA nmapSYN 10 [target host]
		○ Ackscan (scan fw ruleset)
nmap -T4 -v -PN -n -sA --top-ports 100 --max-parallelism 10 -oA nmapSYN 10 [target host]
		○ Aggressive scan (scan open port and identify services (web server version, server OS, cloud server, …))
nmap -T5 -v -PN -A -oA nmapComplete [target host]

---
# Website PenTest

Checklist
	- Reconnaissance (identify all the hosted sites)
	- Webapp firewall scan (detects honeypots)
	- Loadbalance check
	- Webcrawling 
	- Copy the website locally
	- Scan for CMS (Joomla, WP)
	- SSL
	- Web vulnerabilities scan
	- Session token scan
	- SQL injection
	- Maintaining access
	- DOS

WebAppFirewall (wafw00f tool)
	- Command Console: wafw00f www.valami.com

Load Balance Check (lbd)
	- Command console: lbd www.valami.com
Check the presence of any DNS or other LoadBalance solution

Web crawling with BurpSuite
	- Similar webcrawler tools: Dirbuster, Vega, OWASP-ZAP, WebScarab, WebSlayer
	- Goal is to find: admin portal, config files, backup copies, source code, admin notes, any confidential info
	- Crawling steps with BurpSuite: proxy config, target, discover content, run scanner
	- BS Proxy config
		○ Start BS: kali programs > top10 tools
		○ Proxy tab > options > check proxy is checked (localhost:8080)
		○ Go to a browser, install foxyProxy and edit BS as a proxy
		○ Go back to BS: proxy > intercept tab > check it is capturing requests
		○ Proxy > history tab > check all the traffic
	- BS Target
		○ Browse to a website with foxyproxy switched to BS
		○ Open BS > proxy > intercept tab > turn off intercept
		○ BS > target > site map tab > select the website > rightclick add to scope
	- BS Spider
		○ BS > target > site map tab > rightclick site > start spider
	- BS discover content
		○ BS > target > site map > rightclick site > engagement/discover content

Copy website (httrack)
	- Apt-get install httrack
	- Command console: httrack [target site] -v [target folder of the local copy]

SSL Scan (sslscan tool)
	- Command console: sslscan www.valami.com

CMS Scan
	- Command console: wpscan -u [target url] --enumerate vp (find vulnerable plugins)
	- Command console: wpscan -u [target url] --enumerate u (find users)
	- Command console: wpscan -u [target url] --wordlist [password dictionary] (find user password)

Web specific vulnerability scan (burpsuite)
	- Open website in a browser > select BS proxy
	- Open BS > proxy > intercept > turn off interception
	- BS > scanner > live scanning > active scanning / use suite scope
	- BS > target > sitemap > rightclick / spidering
	- BS > spider tab > check spidering is finished
	- BS > target > sitemap > rightclick / actively scan this branch > wizard
		○ Scanner > scan queue (check the process)
		○ Scanner > results
			§ Description of the found vulnerabilities
			§ Severity and the list can be modified
			§ Rightclick tree > report selected issues (html/xml)

SQL Injection (sqlmap)
	- Open website with BS proxy
	- Export request.txt with BS > Proxy > intercept tab
	- Command line: sqlmap …. Request.txt

---
# Internal Pentest

Portscan with Nmap
	- Command console: nmap -A -v -T4 -oA nmapOutput [IP addr]

Vulnerabilities scan with OpenVAS (free Nessus fork)
	- Gui > Kali > Vuln Analisys > OpenVAS > Initial Setup (after install save PASSWORD!!!)
	- Gui > Kali > Vuln Analisys > OpenVAS > Feed update
	- Browser > 127.0.0.1:9392 > login admin/[password from initial setup]
		○ configuration > targets > "blue star" (new target)
		○ Scan management > task (Create new task)
			§ "Play" button to start scan
			§ Result is here
		○ Config > port list (can add new ports to scan)
		○ Config > credentials (add scanning credentials)
		○ Administration > NVT feed > sync

---
# Expoitation

Expoite with Metasploite Framework
	- Scan the system with OpenVAS to find vulnerabilities
	- Start postgresql: service postgresql start
	- Start metaspoite console: msfconsole
		○ list the commands: "?"
		○ Create new workspace: workspace -a [wsname]
		○ …
